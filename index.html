<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>五子棋</title>
  <link rel="stylesheet" href="./index.css">
</head>
<body>
  <div class="main">
    <div class="left">left</div>
    <div class="content">
      <div class="checkerboard">
        <canvas id="myCanvas" width="360" height="360"></canvas>
      </div>
    </div>
    <div class="right">right</div>
  </div>
  <script src="./jquery-3.3.1.min.js"></script>
  <script>
    let ctx = document.getElementById('myCanvas').getContext('2d')
    let count = {
      left: 0,
      top: 0,
      upperLeft: 0, //左上开始
      lowerLeft: 0 //左下开始
    }
    // let machineCount = {
    //   left: 0,
    //   top: 0,
    //   upperLeft: 0, //左上开始
    //   lowerLeft: 0 //左下开始
    // }
    // let count = 0
    // let person = [] //人下棋位置集合
    let machine //机器下棋位置集合
    let chessX, chessY
    // let flag = true
    window.onload = function () {
      Draw()
    }
    $('.checkerboard').click(function (e) {
      // count = {
      //   left: 0,
      //   top: 0,
      //   upperLeft: 0, //左上开始
      //   lowerLeft: 0 //左下开始
      // }
      // count = 0
      Position(e.offsetX, e.offsetY)
    })
    // 绘制棋盘
    function Draw() {
      let ctx = document.getElementById('myCanvas').getContext('2d')
      ctx.lineWidth = 3
      ctx.strokeRect(0, 0, 360, 360)
      ctx.beginPath()
      for (let i = 1; i < 18; i++) {
        ctx.moveTo(0, 20 * i)
        ctx.lineTo(360, 20 * i)
        ctx.moveTo(20 * i, 0)
        ctx.lineTo(20 * i, 360)
      }
      ctx.lineWidth = 1
      ctx.stroke()
      // 标识点
      ctx.beginPath()
      ctx.arc(60, 60, 3, 0, 2 * Math.PI)
      ctx.stroke()
      ctx.beginPath()
      ctx.arc(300, 60, 3, 0, 2 * Math.PI)
      ctx.stroke()
      ctx.beginPath()
      ctx.arc(120, 120, 3, 0, 2 * Math.PI)
      ctx.stroke()
      ctx.beginPath()
      ctx.arc(240, 120, 3, 0, 2 * Math.PI)
      ctx.stroke()
      ctx.beginPath()
      ctx.arc(240, 240, 3, 0, 2 * Math.PI)
      ctx.stroke()
      ctx.beginPath()
      ctx.arc(120, 240, 3, 0, 2 * Math.PI)
      ctx.stroke()
      ctx.beginPath()
      ctx.arc(180, 180, 3, 0, 2 * Math.PI)
      ctx.stroke()
      ctx.beginPath()
      ctx.arc(60, 300, 3, 0, 2 * Math.PI)
      ctx.stroke()
      ctx.beginPath()
      ctx.arc(300, 300, 3, 0, 2 * Math.PI)
      ctx.stroke()

      initMachine()
    }
    function initMachine() {
      machine = new Array(20)
      for (let i = 0; i < 19; i++) {
        machine[i * 20] = new Array(20)
        for (let j = 0; j < 19; j++) {
          machine[i * 20][j * 20] = 0
        }
      }
    }
    // 绘制棋子
    function DrawPiece(color, x, y) {
      ctx.beginPath()
      ctx.arc(x, y, 8, 0, 2 * Math.PI)
      ctx.fillStyle = color
      ctx.strokeStyle = color
      ctx.fill()
      ctx.stroke()
    }
    // 人下棋位置判断
    function Position(x, y) {
      for (let i = x - 8; i < x + 8; i++) {
        for (let j = y - 8; j < y + 8; j++) {
          if (i % 20 === 0 && j % 20 === 0) {
            if (machine[i][j]) {
              break
            }
            console.log(x, y, ' i:' + i + ' j:' + j)
            // flag = true
            DrawPiece('black', i, j)
            // if (ctx.isPointInPath(x, y)) { //点击的点x,y是否在范围内
            // person.push({
            //   x: i,
            //   y: j
            // })
            chessX = i
            chessY = j
            // isWin(i, j)
            // }
            machine[i][j] = 1
            isWin('black', i, j)
          }
        }
      }
      setTimeout(() => {
        MachineChess()
      }, 1000)
    }
    // 机器下棋
    function MachineChess() {
      let x, y
      if (count.left >= 3 && !machine[chessX + 20][chessY]) {
        x = chessX + 20
        y = chessY
      } else if (count.left >= 3 && !machine[chessX - 20][chessY]) {
        x = chessX - 20
        y = chessY
      } else {
        x = chessX - 20
        y = chessY
        // console.log(machine)
        // for (let i = 0; i < 19; i++) {
        //   for (let j = 0; j < 19; j++) {
        //     // console.log(1111,x,y,i,j,i*20,j*20,machine[i*20][j*20])
        //     if (machine[i*20][j*20] === 0) {
        //       x=i
        //       y=j
        //     }
        //   }
        // }
      }

      // console.log(x*20, y*20)
      DrawPiece('white', x, y)
      machine[x][y] = 2
      // console.log(x, y)
      isWin('white', x, y)
    }

    // 判断是否赢了
    function isWin(color, x, y) {
      count = {
        left: 0,
        top: 0,
        upperLeft: 0, //左上开始
        lowerLeft: 0 //左下开始
      }
      // 判断横向
      let temp = color === 'black' ? 1 : 2
      for (let i = 0; i < 5; i++) {
        if(x-20*i<=0) break
        if (machine[x - 20 * i][y] === temp) {
          count.left++
        } else {
          break
        }
      }
      for (let m = 1; m < 5; m++) {
        if(x + 20 * m>=360) break
        if (machine[x + 20 * m][y] === temp) {
          count.left++
        } else {
          break
        }
      }
      // // 判断纵向
      for (let i = 0; i < 5; i++) {
        if(y-20*i<=0) break
        if (machine[x][y - 20 * i] === temp) {
          count.top++
        } else {
          break
        }
      }
      for (let m = 1; m < 5; m++) {
        if(y + 20 * m>=360) break
        if (machine[x][y + 20 * m] === temp) {
          count.top++
        } else {
          break
        }
      }
      // // 判断左上到右下的斜线
      for (let i = 0; i < 5; i++) {
        if(x-20*i<=0&&y - 20 * i<=0) break
        console.log(machine[x - 20 * i][y - 20 * i] , temp)
        if (machine[x - 20 * i][y - 20 * i] === temp) {
          count.upperLeft++
        } else {
          break
        }
      }
      for (let m = 1; m < 5; m++) {
        if(x+20*m>=360&&y + 20 * m>=360) break
        console.log(machine[x + 20 * m][y + 20 * m] , temp)
        if (machine[x + 20 * m][y + 20 * m] === temp) {
          count.upperLeft++
        } else {
          break
        }
      }
      // // 判断左下到右上的斜线
      for (let i = 0; i < 5; i++) {
        if(x-20*i<=0&&y + 20 * i>=360) break
        if (machine[x - 20 * i][y + 20 * i] === temp) {
          count.lowerLeft++
        } else {
          break
        }
      }
      for (let m = 1; m < 5; m++) {
        machine[x + 20 * m]=[]
        if(x+20*m>=360&&y - 20 * m<=0) break
        // console.log(222,x,y,x + 20 * m,y - 20 * m,machine[x + 20 * m][y - 20 * m],machine)
        if (machine[x + 20 * m][y - 20 * m] === temp) {
          count.lowerLeft++
        } else {
          break
        }
      }
      console.log(count)
      if (count.left >= 5 || count.top >= 5 || count.upperLeft >= 5 || count.lowerLeft >= 5) {
        alert('you win')
      }
    }
  </script>
</body>

</html>